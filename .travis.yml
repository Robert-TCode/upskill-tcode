# environment setup
osx_image: xcode12
language: swift

# install dependencies
install:
- ./install_swiftlint.sh
- bundle install
- bundle update fastlane

# scan app and check tests
script:
- if [ "$TRAVIS_BRANCH" = "main" ]; then echo 'You are on brack main'; else echo 'You are not on the main branch'; fi
- swiftlint
- fastlane scan
- xcodebuild -scheme UpSkill -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 11,OS=14.0' build test

# deploy app to Test Flight and App Store Connect
after_success:
#- bash <(curl -s https://codecov.io/bash)
- fastlane build_and_deliver_internally
- if [ "$TRAVIS_BRANCH" = "main" ]; then fastlane deliver_to_app_store; else echo 'Skipping App Store upload'; fi



